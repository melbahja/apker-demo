version: v1
name: my-nginx-demo
image:
  size: small
  from: centos-8-x64 # distro-version-arch

provider:
  name: {{Env "APKER_PROVIDER"}}
  credentials:
    API_KEY: {{Env "APKER_KEY"}}

# Git is required you need to specify the git install commands
setup:
  - dnf update -y
  - dnf install rsync -y
  - dnf install git -y

deploy:
  steps:
    - run dnf install nginx -y
    - copy public/ /usr/share/nginx/html/
    - run chown nginx:nginx /usr/share/nginx/html/ -R
    - run systemctl enable nginx
    - run systemctl start nginx
    - reboot

actions:
  status: systemctl status nginx
  restart: systemctl restart nginx
  reboot: reboot &

# Events will be executed on local machine not remote!
events:
  error: echo "error on deploy steps"
  done: echo "done"
